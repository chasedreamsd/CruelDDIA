## DDIA Ch5, P161 - P166，0917

## 延迟复制的问题
- 读多写少比较常见
- 同步复制，单节点故障无法写入
- 异步读取，数据过时
- 通过最终一致性实现，关系型数据库也有
- 复制延迟有三个问题

## 读己之写
- 写入主，同步到从1，但是读从2
- 读己之写一致性的需求， read-your-writes consistency
- 写后读一致性的方法，read-after-write
- 方法一，从主库读取自己的信息，从库读取其他用户的信息
- 方法二，上次更新一分钟内，从主库读取
- 方法三，客户端记录上次更新时间，系统确保用户读的时候，更新日期之前的数据已经同步
- 方法三需要跨设备的写后读一致性

## 单调读
- 用户时光倒流
- 写入主，同步从1，读取从1有，过段时间，读取从2没有
- 解决办法，每个用户从一个副本读取，基于用户ID散列来选择副本节点

## 一致前缀读 consitent prefix read
- 问题写入主1，回答写入主2，同步从22，同步从11
- 看起来先回答，后问问题
- 第六章分区分片会讲到这个问题的解决方案

## 复制延迟的解决方案 P167 - P171
